(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[124],{9026:(e,t,r)=>{Promise.resolve().then(r.bind(r,42436))},10308:(e,t,r)=>{"use strict";r.d(t,{J:()=>o});var n=r(12115),c=r(56166);function o(){let e=n.useContext(c.Rs);if(!e)throw Error("useUser must be used within a UserProvider");return e}},42436:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>L});var n=r(95155),c=r(12115),o=r(85483),u=r(45365),i=r(94049),l=r(79101),a=r(75581),s=r(41877),d=r(37469),f=r(22003),h=r(98040),w=r(65842),v=r(25619);r(20729);var x=r(90610),p=r(57476),m=r(5946),S=r(30758),g=r(29249),b=r(10308),k=r(3596),E=r(20063),y=r(24274);function A(){let e=(0,E.useRouter)(),t=c.useRef(null),r=c.useRef(null),o=c.useRef(null),u=c.useRef(null),A=c.useRef(null),[N,L]=c.useState(!1),j=c.useRef(!1),P=c.useRef(!1),[B,C]=c.useState(!1),[R,D]=c.useState(!1),{checkSessionError:O}=(0,b.J)(),T=c.useRef(!1),{t:U}=(0,y.Bd)(),{user:V}=(0,b.J)(),W=c.useRef(!1);null===V&&(W.current=!0,V={id:"",sideNavVisibility:new Map}),c.useEffect(()=>{var e;let r=()=>{if(window.visualViewport){let e=window.innerHeight-window.visualViewport.height;e>20?(t.current&&(t.current.style.height="calc(".concat(e,"px + var(--Footer-height-mobile) + 24px)")),A.current&&(A.current.style.bottom="calc(".concat(e,"px - var(--Footer-height-mobile) + 8px)"))):(t.current&&(t.current.style.height="100%"),A.current&&(A.current.style.bottom="16px")),u.current&&u.current()}};return null==(e=window.visualViewport)||e.addEventListener("resize",r),r(),()=>{var e;null==(e=window.visualViewport)||e.removeEventListener("resize",r)}},[]);let M=[{icon:(0,n.jsx)(m.A,{}),name:U("SELECT ALL"),action:()=>{r.current&&r.current.selectAll()}},{icon:B?(0,n.jsx)(S.A,{style:{color:"red"}}):(0,n.jsx)(S.A,{}),name:"CTRL",action:()=>{j.current=!j.current,C(j.current)}},{icon:R?(0,n.jsx)(x.A,{style:{color:"red"}}):(0,n.jsx)(x.A,{}),name:"ALT",action:()=>{P.current=!P.current,D(P.current)}},{icon:(0,n.jsx)(g.A,{}),name:"TAB",action:()=>{o.current&&o.current.send("	")}},{icon:(0,n.jsx)(p.A,{}),name:"ESC",action:()=>{o.current&&o.current.send("\x1b")}}],_=(e,t)=>{let r=new ArrayBuffer(5),n=new DataView(r);o.current&&o.current.readyState===WebSocket.OPEN&&(n.setUint8(0,2),n.setUint16(1,e),n.setUint16(3,t),o.current.send(r))};return(c.useEffect(()=>{var n;if(W.current||T.current)return;T.current=!0;let c=new l.B({smoothScrollDuration:200,scrollSensitivity:5,scrollback:3500});r.current=c;let i=new a.Y,f=new d.V;c.loadAddon(i),c.loadAddon(new s.c),c.loadAddon(f),t&&(c.open(t.current),i.fit()),c.onData(e=>{if(!o.current||o.current.readyState!==WebSocket.OPEN)return;let t=e;if(j.current){var r;t=String.fromCodePoint((null!=(r=t.toUpperCase().codePointAt(0))?r:0)-64),j.current=!1,C(!1)}P.current&&(o.current.send("\x1b"),P.current=!1,D(!1)),o.current.send(t)});let h="https:"===window.location.protocol?"wss":"ws",w=!1;if(V.xtermSocket){let e=V.xtermSocket;e.readyState===WebSocket.OPEN||e.readyState===WebSocket.CONNECTING?(o.current=V.xtermSocket,w=!0,(()=>{let e=new ArrayBuffer(1),t=new DataView(e);o.current&&o.current.readyState===WebSocket.OPEN&&(t.setUint8(0,4),o.current.send(e))})()):(e.close(),V.xtermSocket=null,c.write("Resume session failed...\r\n"))}o.current||(c.write(U("Connecting to xterm server...\r\n")),o.current=new WebSocket("".concat(h,"://").concat(window.location.host,"/api/tool/term")),V.xtermSocket=o.current),o.current.onmessage=e=>{if(e.data instanceof ArrayBuffer)v(e.data);else if(e.data instanceof Blob){let t=new FileReader;t.onload=()=>{let e=t.result;e instanceof ArrayBuffer?v(e):(c.write("Invalid data type received.\r\n"),o.current&&(o.current.close(),o.current=null))},t.readAsArrayBuffer(e.data)}else{var t;c.write("Invalid data type received.\r\n"),null==(t=o.current)||t.close(),o.current=null}},o.current.onerror=()=>{k.y.checkLogin().then(t=>{t.error&&O&&(O(t.error).catch(e=>{}),e.refresh())}).catch(e=>{})},o.current.onopen=()=>{c.clear(),c.reset(),c.focus(),i.fit(),_(c.cols,c.rows)},o.current.onclose=()=>{c.write(U("Connection closed.\r\n")),o.current=null},window.addEventListener("resize",()=>{i.fit(),_(c.cols,c.rows)}),window.addEventListener("beforeunload",()=>{var e;null==(e=o.current)||e.close(),o.current=null}),null==(n=t.current)||n.addEventListener("touchstart",e=>{var n,c;let o=e.touches[0].clientY,u=!1;t.current&&r.current&&(e.preventDefault(),e.stopPropagation(),null==(n=t.current)||n.addEventListener("touchmove",e=>{e.preventDefault(),e.stopPropagation();let n=o-e.touches[0].clientY;t.current&&r.current&&0!==n&&(n>0?r.current.scrollLines(-Math.ceil(n/30)):n<0&&r.current.scrollLines(Math.ceil(-n/30)),u=!0)}),null==(c=t.current)||c.addEventListener("touchend",e=>{var n,c,o;e.preventDefault(),e.stopPropagation(),null==(n=t.current)||n.removeEventListener("touchstart",()=>{}),null==(c=t.current)||c.removeEventListener("touchmove",()=>{}),null==(o=t.current)||o.removeEventListener("touchend",()=>{}),r.current&&(u||r.current.focus())}))}),u.current=()=>{r.current&&(i.fit(),_(r.current.cols,r.current.rows))};let v=e=>{let t=new DataView(e);switch(t.getUint8(0)){case 0:{let t=new TextDecoder().decode(e.slice(1));c.write(t);break}case 1:{let t=new TextDecoder().decode(e.slice(1));c.write(t);break}case 2:{let e=t.getUint16(1),r=t.getUint16(3);c.resize(e,r)}}};return w&&(u.current&&(_(c.cols,c.rows+10),i.fit(),u.current()),V.xtermBuff&&c.write(V.xtermBuff)),()=>{(()=>{if(o.current){if(o.current.readyState!==WebSocket.OPEN&&o.current.readyState!==WebSocket.CONNECTING){o.current.close(),V.xtermSocket=null;return}o.current.readyState===WebSocket.OPEN&&(()=>{let e=new ArrayBuffer(1),t=new DataView(e);o.current&&o.current.readyState===WebSocket.OPEN&&(t.setUint8(0,3),o.current.send(e))})(),o.current.onopen=()=>{},o.current.onmessage=()=>{V.xtermBuff&&(V.xtermBuff=null)},o.current.onerror=()=>{},o.current.onclose=()=>{o.current=null,V.xtermSocket=null}}})();let e=f.serialize();e&&(V.xtermBuff=e),o.current=null,T.current=!1,c.dispose()}},[U,O,e,V]),W.current)?(V.xtermSocket&&(V.xtermSocket.close(),V.xtermSocket=null),(0,n.jsx)(f.A,{severity:"info",children:"Please Refresh Page."})):(0,n.jsxs)(i.default,{sx:{position:"relative",height:"100%",width:"100%"},children:[(0,n.jsx)(v.A,{ref:A,ariaLabel:"Xterm ToolBar",sx:{position:"absolute",bottom:16,right:16},icon:(0,n.jsx)(h.A,{}),onClick:e=>{e.preventDefault(),e.stopPropagation(),L(e=>!e),r.current&&r.current.focus()},open:N,direction:"up",children:M.map(e=>{let t;return(0,n.jsx)(w.A,{tooltipTitle:e.name,icon:e.icon,onClick:(t=e.action,e=>{e.preventDefault(),e.stopPropagation(),t(),r.current&&r.current.focus()})},e.name)})}),(0,n.jsx)(i.default,{ref:t,sx:{height:"100%",width:"100%"}})]})}function N(){return(0,n.jsx)(o.default,{spacing:1,children:(0,n.jsx)(i.default,{sx:{position:"absolute",top:"var(--MainNav-height)",left:{lg:"var(--SideNav-width)",xs:0},right:0,height:{lg:"calc(100% - var(--MainNav-height) - var(--Footer-height))",xs:"calc(100% - var(--MainNav-height) - var(--Footer-height-mobile))"},width:{lg:"calc(100% - var(--SideNav-width))",xs:"100%"}},children:(0,n.jsx)(A,{})})})}function L(){let{t:e}=(0,y.Bd)();return c.useEffect(()=>{document.title="".concat(e("Terminal")," | ").concat(e("Dashboard")," | ").concat(u.$.site.name)},[e]),(0,n.jsx)(o.default,{spacing:1,height:"100%",children:(0,n.jsx)(N,{})})}}},e=>{e.O(0,[786,888,393,319,169,190,411,628,166,441,255,358],()=>e(e.s=9026)),_N_E=e.O()}]);