(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[814],{10308:(e,t,r)=>{"use strict";r.d(t,{J:()=>o});var n=r(12115),a=r(56166);function o(){let e=n.useContext(a.Rs);if(!e)throw Error("useUser must be used within a UserProvider");return e}},24602:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>N});var n=r(95155),a=r(12115),o=r(85483),l=r(45365),i=r(37665),s=r(33567),c=r(78470),u=r(41983),d=r(29767),m=r(76530),g=r(22454),p=r(34049),h=r(43522),C=r(99776),y=r(8106),f=r(10308),S=r(24274),b=r(266),w=r(36274),v=r(41130),A=r(65907),I=r(4484),D=r(71991);function P(){var e,t,r,o;let{t:l}=(0,S.Bd)(),d="clients-table-column-visibility",h="clients-table-column-sizing",C="clients-table-pagination",P=localStorage.getItem(d),_=localStorage.getItem(h),x=localStorage.getItem(C),N={},k={},E={pageIndex:0,pageSize:10};try{P&&(N=JSON.parse(P))}catch(e){localStorage.removeItem(d),N={}}try{_&&(k=JSON.parse(_))}catch(e){localStorage.removeItem(h),k={}}try{x&&(E=JSON.parse(x))}catch(e){localStorage.removeItem(C),E={pageIndex:0,pageSize:10}}let O=N||{},[z,T]=a.useState(O),[q,F]=a.useState(k),R=(0,a.useMemo)(()=>[{accessorKey:"id",header:l("ID"),size:110,enableColumnActions:!1,columnFilterModeOptions:["equals"]},{accessorKey:"client_ip",header:l("Client IP"),size:360,enableColumnActions:!1,columnFilterModeOptions:["contains","equals"]},{accessorKey:"mac",header:l("Mac Address"),size:240,enableColumnActions:!1,columnFilterModeOptions:["equals"]},{accessorKey:"hostname",header:l("Host Name"),size:250,enableColumnActions:!1,columnFilterModeOptions:["equals"]},{accessorKey:"last_query_timestamp",header:l("Last Query Time"),Cell:e=>{let{cell:t}=e,r=new Date(t.getValue()).toLocaleString();return(0,n.jsx)("span",{children:r})},columnFilterModeOptions:["equals"],enableColumnActions:!1,size:120}],[l]),{checkSessionError:j}=(0,f.J)(),[M,L]=(0,a.useState)([]),[Q,J]=(0,a.useState)(()=>Object.fromEntries(R.map(e=>{let{accessorKey:t}=e;return[t,"equals"]}))),[U,B]=(0,a.useState)(!1),[H,K]=(0,a.useState)(""),[V,W]=(0,a.useState)("Error loading data"),[G,Y]=(0,a.useState)([]),X=a.useRef(0),$=a.useRef(null),[Z,ee]=(0,a.useState)(E),[et,er]=(0,a.useState)(0),en=a.useRef(!1),[ea,eo]=(0,a.useState)(b.q),{enqueueSnackbar:el}=(0,D.dh)(),ei=a.useRef(!1);window.innerWidth>=1200&&(ei.current=!0),a.useEffect(()=>{let e=new URLSearchParams(location.search),t=[];for(let[r,n]of e.entries())R.some(e=>e.accessorKey===r)&&t.push({id:r,value:n});L(t),U||B(!0)},[U,R]);let{data:{data:es=[],meta:ec}={},isError:eu,isRefetching:ed,isLoading:em,refetch:eg}=(0,g.I)({enabled:U,queryKey:["table-data",Q,M,H,Z.pageIndex,Z.pageSize,G],queryFn:async()=>{let e=Z.pageIndex+1,t={page_num:e,page_size:Z.pageSize};for(let r of(en.current&&(en.current=!1,t.total_count=et),null!==$.current&&void 0!==$.current&&(e>X.current&&e===X.current+1?$.current.lastID>=0&&(t.cursor=$.current.lastID,t.total_count=et,t.cursor_direction="next"):e<X.current&&e===X.current-1&&$.current.firstID>=0&&(t.cursor=$.current.firstID,t.total_count=et,t.cursor_direction="prev")),X.current=e,M))if(null!==r.id&&void 0!==r.id&&null!==r.value&&void 0!==r.value){if("last_query_timestamp"===r.id){let e=r.value;2===e.length&&(e[0]&&(t.timestamp_after=new Date(e[0]).getTime()),e[1]&&(t.timestamp_before=new Date(e[1]).getTime()))}t[r.id]=r.value}let r=await y.Y.GetClients(t);if(r.error)throw await (null==j?void 0:j(r.error)),W(y.Y.getErrorMessage(r.error)),Error(V);if(null===r.data||void 0===r.data)throw W("Error loading data"),Error(V);let n=0;return r.data.total_count>0&&r.data.client_list.length>0&&($.current={firstID:r.data.client_list[0].id,lastID:r.data.client_list.at(-1).id,pageNumber:e+1},n=r.data.total_count),er(n),{data:r.data.client_list,meta:{totalRowCount:n}}},placeholderData:p.rX});a.useEffect(()=>{null!==v.A.language&&void 0!==v.A.language&&("zh-CN"===v.A.language?eo(w.q):eo(b.q))},[]);let ep=a.useCallback(async e=>{el(l("Not implemented yet."),{style:{whiteSpace:"pre-line"}})},[l,el]),eh=a.useCallback(async e=>{let t=e.original.id,r=e.original.client_ip,n=await y.Y.DeleteClientById(t);if(n.error)return void el("".concat(l("Error"),": ").concat(l(y.Y.getErrorMessage(n.error)),", id: ").concat(t),{variant:"error"});el(l("Delete client {{id}} {{client_ip}} successfully.",{id:t,clientIP:r}),{variant:"success"})},[l,el]),eC=(e,t,r)=>[(0,n.jsx)(i.Jk,{icon:(0,n.jsx)(A.A,{}),label:"Mac Vendor",onClick:async r=>{r.preventDefault(),e(),await ep(t)},table:r},"mac_vendor"),(0,n.jsx)(i.Jk,{icon:(0,n.jsx)(I.A,{}),label:"Delete",onClick:async r=>{r.preventDefault(),e(),await eh(t)},table:r},"delete")],ey=(0,s.A)(),ef=getComputedStyle(document.documentElement),eS=/--[^)]+/.exec(null!=(r=null==(t=ey.palette)||null==(e=t.background)?void 0:e.paper)?r:""),eb=eS?eS[0]:"",ew=ef.getPropertyValue(null!=eb?eb:"").trim(),ev=(0,i.Up)({columns:R,data:es,localization:ea,enableColumnResizing:!0,enableSorting:!1,enableColumnOrdering:!0,enableRowActions:!0,enableCellActions:!0,enableClickToCopy:window.isSecureContext,enableGlobalFilter:!1,columnFilterDisplayMode:"popover",enableColumnFilterModes:!0,enableColumnPinning:!0,enableColumnDragging:!1,enableKeyboardShortcuts:!1,manualFiltering:!0,manualPagination:!0,manualSorting:!0,muiFilterDateTimePickerProps:{ampm:!1},muiPaginationProps:{disabled:ed},muiToolbarAlertBannerProps:eu?{color:"error",children:V}:void 0,onColumnFilterFnsChange:J,onColumnFiltersChange:e=>{L(e)},onGlobalFilterChange:e=>{K(e)},onPaginationChange:e=>{let t="function"==typeof e?e(Z):e;ee(t),localStorage.setItem(C,JSON.stringify(t))},onSortingChange:Y,onColumnVisibilityChange:e=>{let t="function"==typeof e?e(z):e;T(t),localStorage.setItem(d,JSON.stringify(t))},onColumnSizingChange:e=>{let t="function"==typeof e?e(q):e;F(t),localStorage.setItem(h,JSON.stringify(t))},renderTopToolbarCustomActions:()=>(0,n.jsx)(c.A,{arrow:!0,title:l("Refresh Data"),children:(0,n.jsx)("span",{children:(0,n.jsx)(u.A,{disabled:ed,onClick:()=>{eg().catch(e=>{})},children:(0,n.jsx)(m.A,{})})})}),renderRowActionMenuItems:e=>{let{closeMenu:t,row:r,table:n}=e;return[eC(t,r,n)]},renderCellActionMenuItems:e=>{let{closeMenu:t,cell:r,row:n,table:a,internalMenuItems:o}=e;return[[eC(t,n,a)],...o]},muiLinearProgressProps:{color:"primary",variant:"determinate",value:ed?50:100},rowCount:null!=(o=null==ec?void 0:ec.totalRowCount)?o:0,initialState:{columnVisibility:z,columnSizing:q,columnPinning:{right:(null==ei?void 0:ei.current)?["mrt-row-actions"]:[]}},state:{columnFilters:M,columnFilterFns:Q,globalFilter:H,isLoading:em,pagination:Z,columnVisibility:z,columnSizing:q,showAlertBanner:eu,showProgressBars:ed,showSkeletons:em,sorting:G},mrtTheme:e=>({baseBackgroundColor:ew})});return(0,n.jsx)(i.zp,{table:ev})}let _=new h.E({defaultOptions:{queries:{refetchOnWindowFocus:!1,gcTime:0,retry:!1}}});function x(){let[e,t]=a.useState({vertical:"top",horizontal:"left"});return a.useEffect(()=>{let e=window.matchMedia("(max-width: 600px)"),r=e=>{e.matches?t({vertical:"top",horizontal:"left"}):t({vertical:"bottom",horizontal:"left"})};return e.matches?t({vertical:"top",horizontal:"left"}):t({vertical:"bottom",horizontal:"left"}),e.addEventListener("change",r),()=>{e.removeEventListener("change",r)}},[t]),(0,n.jsx)(C.Ht,{client:_,children:(0,n.jsx)(D.n,{anchorOrigin:e,maxSnack:5,autoHideDuration:6e3,children:(0,n.jsx)(d.A,{children:(0,n.jsx)(P,{})})})})}function N(){let{t:e}=(0,S.Bd)();return a.useEffect(()=>{document.title="".concat(e("Clients")," | ").concat(e("Dashboard")," | ").concat(l.$.site.name)},[e]),(0,n.jsx)(o.default,{spacing:2,children:(0,n.jsx)(x,{})})}},36192:(e,t,r)=>{Promise.resolve().then(r.bind(r,24602))},41130:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(30338),a=r(24274),o=r(91708);let l=JSON.parse('{"Username":"用户名","Password":"密码","Sign in":"登录","Old password":"旧密码","Auth":"认证","Confirm password":"确认密码","New password":"新密码","Password mismatch.":"密码不匹配","Incorrect password.":"密码错误","Incorrect username or password.":"用户名或密码错误","Too many login attempts, please try again later.":"登录尝试次数过多，请稍后再试。","New password must be different from old password.":"新密码必须与旧密码不同","Password updated successfully.":"密码更新成功","Old password is required.":"旧密码是必需的","New password is required.":"新密码是必需的","Confirm password is required.":"确认密码是必需的","Username is required.":"用户名是必需的","Password is required.":"密码是必需的","Sign in smartdns dashboard.":"登录 smartdns 仪表盘","Dashboard":"仪表盘","Hourly Query Count":"每小时查询次数","Query Count":"查询次数","Daily Query Count":"每日查询次数","Domain":"域名","Type":"类型","Client":"客户端","Time":"时间","Ping":"Ping","Group":"组","Query Time":"查询时间","Reply Code":"回应码","Is Blocked":"是否阻止","Pause":"暂停","Resume":"恢复","Clear":"清空","Clear Cache":"清除缓存","Clear Cache Success":"清除缓存成功","Clear Cache Failed":"清除缓存失败","Copy":"复制","Query":"查询","Delete":"删除","Debug":"调试","Info":"信息","Notice":"通知","Warning":"警告","Warn":"警告","Error":"错误","Fatal":"致命","Run Log":"运行日志","Audit Log":"审计日志","Overview":"概览","Total Query Count":"总查询次数","Blocked Query Count":"被阻止的查询次数","Cache Hit Rate":"缓存命中率","Cache Number":"缓存数量","Query Per Second":"每秒查询次数","Average Query Time":"平均查询时间","Top Clients":"最多查询客户端","Top Domains":"最多查询域名","Organization":"组织","Refresh Data":"刷新数据","Count":"次数","Query Log":"查询日志","Log":"日志","Terminal":"终端","Settings":"设置","Update":"更新","Language":"语言","Home":"首页","Official Site":"官方网站","Source":"源代码","Issues":"问题列表","About":"关于","SELECT ALL":"全选","Sign out":"登出","Copyright":"版权所有","unexpected socket close\\n":"意外的套接字关闭\\n","Connecting to {{logtype}} stream....\\n":"连接到{{logtype}}流....\\n","Connected to {{logtype}} stream.\\n":"已连接到{{logtype}}流。\\n","Disconnected from {{logtype}} stream.\\n":"已断开与{{logtype}}流的连接。\\n","Connecting to xterm server...\\r\\n":"连接到 xterm 服务器...\\r\\n","Connection closed.\\r\\n":"连接已关闭。\\r\\n","Nick Peng. All rights reserved.":"Nick Peng，保留所有权利。","Failed to fetch":"获取失败","Internal Server Error":"内部服务器错误","No data returned.":"没有返回数据。","Not found":"未找到","Cannot find whois.":"找不到 whois。","Whois data not available":"Whois 数据不可用","Registrar":"注册商","Country":"国家","Delete query log {{id}} {{domain}} successfully.":"删除查询日志 {{id}} {{domain}} 成功。","Error: Connection Closed, Reconnecting...":"错误：连接已关闭，正在重新连接...","Upstream Servers":"上游服务器","Server":"服务器","Host":"主机","Port":"端口","Success Rate":"成功率","Status":"状态","Unknown":"未知","Normal":"正常","Abnormal":"异常","Security":"安全性","Insecure":"不安全","Secure":"安全","Verify Failed":"验证失败","Not Applicable":"不适用","Avg Time":"平均时间","Total Success Number":"总成功次数","Clients":"客户端","Client IP":"客户端 IP","ID":"ID","Mac Address":"MAC 地址","Host Name":"主机名","Last Query Time":"最后查询时间","Error loading data":"加载数据时出错","Not implemented yet.":"尚未实现。","Delete client {{id}} {{client_ip}} successfully.":"删除客户端 {{id}} {{client_ip}} 成功。","Server request processing has been suspended, please check whether there is enough disk space.":"服务器请求处理已暂停，请检查是否有足够的磁盘空间。","Audit log is not enabled, please set `audit-enable` to `yes` in smartdns config file.":"审计日志未启用，请在smartdns配置文件中将 `audit-enable` 设置为 `yes`。","QPS":"查询数","UI Version":"UI 版本","Server Version":"服务器版本"}');n.Ay.use(o.A).use(a.r9).init({resources:{"zh-CN":{translation:l}},debug:!1,fallbackLng:"en",keySeparator:!1,nsSeparator:!1,interpolation:{escapeValue:!1}});let i=n.Ay}},e=>{e.O(0,[740,393,319,169,190,705,107,690,984,217,411,29,981,776,959,484,166,441,255,358],()=>e(e.s=36192)),_N_E=e.O()}]);